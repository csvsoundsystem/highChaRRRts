(function(undefined){var moment,VERSION="1.7.2",round=Math.round,i,languages={},currentLanguage='en',hasModule=(typeof module!=='undefined'&&module.exports),langConfigProperties='months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem'.split('|'),aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,parseMultipleFormatChunker=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenWord=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,isoRegex=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,isoFormat='YYYY-MM-DDTHH:mm:ssZ',isoTimes=[['HH:mm:ss.S',/T\d\d:\d\d:\d\d\.\d{1,3}/],['HH:mm:ss',/T\d\d:\d\d:\d\d/],['HH:mm',/T\d\d:\d\d/],['HH',/T\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters='Month|Date|Hours|Minutes|Seconds|Milliseconds'.split('|'),unitMillisecondFactors={'Milliseconds':1,'Seconds':1e3,'Minutes':6e4,'Hours':36e5,'Days':864e5,'Months':2592e6,'Years':31536e6},formatFunctions={},ordinalizeTokens='DDD w M D d'.split(' '),paddedTokens='M D H h m s w'.split(' '),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return getValueFromArray("monthsShort",this.month(),this,format)},MMMM:function(format){return getValueFromArray("months",this.month(),this,format)},D:function(){return this.date()},DDD:function(){var a=new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return~~(((a-b)/864e5)+1.5)},d:function(){return this.day()},dd:function(format){return getValueFromArray("weekdaysMin",this.day(),this,format)},ddd:function(format){return getValueFromArray("weekdaysShort",this.day(),this,format)},dddd:function(format){return getValueFromArray("weekdays",this.day(),this,format)},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return~~((a-b)/864e5/7+1.5)},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return leftZeroFill(~~(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-"}return b+leftZeroFill(~~(a/60),2)+":"+leftZeroFill(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-"}return b+leftZeroFill(~~(10*a/6),4)}};function getValueFromArray(key,index,m,format){var lang=m.lang();return lang[key].call?lang[key](m,format):lang[key][index]}function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func){return function(a){var b=func.call(this,a);return b+this.lang().ordinal(b)}}while(ordinalizeTokens.length){i=ordinalizeTokens.pop();formatTokenFunctions[i+'o']=ordinalizeToken(formatTokenFunctions[i])}while(paddedTokens.length){i=paddedTokens.pop();formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2)}formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3);function Moment(date,isUTC,lang){this._d=date;this._isUTC=!!isUTC;this._a=date._a||null;this._lang=lang||false}function Duration(duration){var data=this._data={},years=duration.years||duration.y||0,months=duration.months||duration.M||0,weeks=duration.weeks||duration.w||0,days=duration.days||duration.d||0,hours=duration.hours||duration.h||0,minutes=duration.minutes||duration.m||0,seconds=duration.seconds||duration.s||0,milliseconds=duration.milliseconds||duration.ms||0;this._milliseconds=milliseconds+seconds*1e3+minutes*6e4+hours*36e5;this._days=days+weeks*7;this._months=months+years*12;data.milliseconds=milliseconds%1000;seconds+=absRound(milliseconds/1000);data.seconds=seconds%60;minutes+=absRound(seconds/60);data.minutes=minutes%60;hours+=absRound(minutes/60);data.hours=hours%24;days+=absRound(hours/24);days+=weeks*7;data.days=days%30;months+=absRound(days/30);data.months=months%12;years+=absRound(months/12);data.years=years;this._lang=false}function absRound(number){if(number<0){return Math.ceil(number)}else{return Math.floor(number)}}function leftZeroFill(number,targetLength){var output=number+'';while(output.length<targetLength){output='0'+output}return output}function addOrSubtractDurationFromMoment(mom,duration,isAdding){var ms=duration._milliseconds,d=duration._days,M=duration._months,currentDate;if(ms){mom._d.setTime(+mom+ms*isAdding)}if(d){mom.date(mom.date()+d*isAdding)}if(M){currentDate=mom.date();mom.date(1).month(mom.month()+M*isAdding).date(Math.min(currentDate,mom.daysInMonth()))}}function isArray(input){return Object.prototype.toString.call(input)==='[object Array]'}function compareArrays(array1,array2){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(~~array1[i]!==~~array2[i]){diffs++}}return diffs+lengthDiff}function dateFromArray(input,asUTC,hoursOffset,minutesOffset){var i,date,forValid=[];for(i=0;i<7;i++){forValid[i]=input[i]=(input[i]==null)?(i===2?1:0):input[i]}input[7]=forValid[7]=asUTC;if(input[8]!=null){forValid[8]=input[8]}input[3]+=hoursOffset||0;input[4]+=minutesOffset||0;date=new Date(0);if(asUTC){date.setUTCFullYear(input[0],input[1],input[2]);date.setUTCHours(input[3],input[4],input[5],input[6])}else{date.setFullYear(input[0],input[1],input[2]);date.setHours(input[3],input[4],input[5],input[6])}date._a=forValid;return date}function loadLang(key,values){var i,m,parse=[];if(!values&&hasModule){values=require('./lang/'+key)}for(i=0;i<langConfigProperties.length;i++){values[langConfigProperties[i]]=values[langConfigProperties[i]]||languages.en[langConfigProperties[i]]}for(i=0;i<12;i++){m=moment([2000,i]);parse[i]=new RegExp('^'+(values.months[i]||values.months(m,''))+'|^'+(values.monthsShort[i]||values.monthsShort(m,'')).replace('.',''),'i')}values.monthsParse=values.monthsParse||parse;languages[key]=values;return values}function getLangDefinition(m){var langKey=(typeof m==='string')&&m||m&&m._lang||null;return langKey?(languages[langKey]||loadLang(langKey)):moment}function removeFormattingTokens(input){if(input.match(/\[.*\]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="";for(i=0;i<length;i++){output+=typeof array[i].call==='function'?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){var i=5;function replaceLongDateFormatTokens(input){return m.lang().longDateFormat[input]||input}while(i--&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens)}if(!formatFunctions[format]){formatFunctions[format]=makeFormatFunction(format)}return formatFunctions[format](m)}function getParseRegexForToken(token){switch(token){case'DDDD':return parseTokenThreeDigits;case'YYYY':return parseTokenFourDigits;case'S':case'SS':case'SSS':case'DDD':return parseTokenOneToThreeDigits;case'MMM':case'MMMM':case'dd':case'ddd':case'dddd':case'a':case'A':return parseTokenWord;case'Z':case'ZZ':return parseTokenTimezone;case'T':return parseTokenT;case'MM':case'DD':case'YY':case'HH':case'hh':case'mm':case'ss':case'M':case'D':case'd':case'H':case'h':case'm':case's':return parseTokenOneOrTwoDigits;default:return new RegExp(token.replace('\\',''))}}function addTimeToArrayFromToken(token,input,datePartArray,config){var a,b;switch(token){case'M':case'MM':datePartArray[1]=(input==null)?0:~~input-1;break;case'MMM':case'MMMM':for(a=0;a<12;a++){if(getLangDefinition().monthsParse[a].test(input)){datePartArray[1]=a;b=true;break}}if(!b){datePartArray[8]=false}break;case'D':case'DD':case'DDD':case'DDDD':if(input!=null){datePartArray[2]=~~input}break;case'YY':datePartArray[0]=~~input+(~~input>70?1900:2000);break;case'YYYY':datePartArray[0]=~~Math.abs(input);break;case'a':case'A':config.isPm=((input+'').toLowerCase()==='pm');break;case'H':case'HH':case'h':case'hh':datePartArray[3]=~~input;break;case'm':case'mm':datePartArray[4]=~~input;break;case's':case'ss':datePartArray[5]=~~input;break;case'S':case'SS':case'SSS':datePartArray[6]=~~(('0.'+input)*1000);break;case'Z':case'ZZ':config.isUTC=true;a=(input+'').match(parseTimezoneChunker);if(a&&a[1]){config.tzh=~~a[1]}if(a&&a[2]){config.tzm=~~a[2]}if(a&&a[0]==='+'){config.tzh=-config.tzh;config.tzm=-config.tzm}break}if(input==null){datePartArray[8]=false}}function makeDateFromStringAndFormat(string,format){var datePartArray=[0,0,1,0,0,0,0],config={tzh:0,tzm:0},tokens=format.match(formattingTokens),i,parsedInput;for(i=0;i<tokens.length;i++){parsedInput=(getParseRegexForToken(tokens[i]).exec(string)||[])[0];if(parsedInput){string=string.slice(string.indexOf(parsedInput)+parsedInput.length)}if(formatTokenFunctions[tokens[i]]){addTimeToArrayFromToken(tokens[i],parsedInput,datePartArray,config)}}if(config.isPm&&datePartArray[3]<12){datePartArray[3]+=12}if(config.isPm===false&&datePartArray[3]===12){datePartArray[3]=0}return dateFromArray(datePartArray,config.isUTC,config.tzh,config.tzm)}function makeDateFromStringAndArray(string,formats){var output,inputParts=string.match(parseMultipleFormatChunker)||[],formattedInputParts,scoreToBeat=99,i,currentDate,currentScore;for(i=0;i<formats.length;i++){currentDate=makeDateFromStringAndFormat(string,formats[i]);formattedInputParts=formatMoment(new Moment(currentDate),formats[i]).match(parseMultipleFormatChunker)||[];currentScore=compareArrays(inputParts,formattedInputParts);if(currentScore<scoreToBeat){scoreToBeat=currentScore;output=currentDate}}return output}function makeDateFromString(string){var format='YYYY-MM-DDT',i;if(isoRegex.exec(string)){for(i=0;i<4;i++){if(isoTimes[i][1].exec(string)){format+=isoTimes[i][0];break}}return parseTokenTimezone.exec(string)?makeDateFromStringAndFormat(string,format+' Z'):makeDateFromStringAndFormat(string,format)}return new Date(string)}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){var rt=lang.relativeTime[string];return(typeof rt==='function')?rt(number||1,!!withoutSuffix,string,isFuture):rt.replace(/%d/i,number||1)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1000),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=seconds<45&&['s',seconds]||minutes===1&&['m']||minutes<45&&['mm',minutes]||hours===1&&['h']||hours<22&&['hh',hours]||days===1&&['d']||days<=25&&['dd',days]||days<=45&&['M']||days<345&&['MM',round(days/30)]||years===1&&['y']||['yy',years];args[2]=withoutSuffix;args[3]=milliseconds>0;args[4]=lang;return substituteTimeAgo.apply({},args)}moment=function(input,format){if(input===null||input===''){return null}var date,matched;if(moment.isMoment(input)){return new Moment(new Date(+input._d),input._isUTC,input._lang)}else if(format){if(isArray(format)){date=makeDateFromStringAndArray(input,format)}else{date=makeDateFromStringAndFormat(input,format)}}else{matched=aspNetJsonRegex.exec(input);date=input===undefined?new Date():matched?new Date(+matched[1]):input instanceof Date?input:isArray(input)?dateFromArray(input):typeof input==='string'?makeDateFromString(input):new Date(input)}return new Moment(date)};moment.utc=function(input,format){if(isArray(input)){return new Moment(dateFromArray(input,true),true)}if(typeof input==='string'&&!parseTokenTimezone.exec(input)){input+=' +0000';if(format){format+=' Z'}}return moment(input,format).utc()};moment.unix=function(input){return moment(input*1000)};moment.duration=function(input,key){var isDuration=moment.isDuration(input),isNumber=(typeof input==='number'),duration=(isDuration?input._data:(isNumber?{}:input)),ret;if(isNumber){if(key){duration[key]=input}else{duration.milliseconds=input}}ret=new Duration(duration);if(isDuration){ret._lang=input._lang}return ret};moment.humanizeDuration=function(num,type,withSuffix){return moment.duration(num,type===true?null:type).humanize(type===true?true:withSuffix)};moment.version=VERSION;moment.defaultFormat=isoFormat;moment.lang=function(key,values){var i;if(!key){return currentLanguage}if(values||!languages[key]){loadLang(key,values)}if(languages[key]){for(i=0;i<langConfigProperties.length;i++){moment[langConfigProperties[i]]=languages[key][langConfigProperties[i]]}moment.monthsParse=languages[key].monthsParse;currentLanguage=key}};moment.langData=getLangDefinition;moment.isMoment=function(obj){return obj instanceof Moment};moment.isDuration=function(obj){return obj instanceof Duration};moment.lang('en',{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(hours,minutes,isLower){if(hours>11){return isLower?'pm':'PM'}else{return isLower?'am':'AM'}},calendar:{sameDay:'[Today at] LT',nextDay:'[Tomorrow at] LT',nextWeek:'dddd [at] LT',lastDay:'[Yesterday at] LT',lastWeek:'[last] dddd [at] LT',sameElse:'L'},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(number){var b=number%10;return(~~(number%100/10)===1)?'th':(b===1)?'st':(b===2)?'nd':(b===3)?'rd':'th'}});moment.fn=Moment.prototype={clone:function(){return moment(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds(),!!this._isUTC]},isValid:function(){if(this._a){if(this._a[8]!=null){return!!this._a[8]}return!compareArrays(this._a,(this._a[7]?moment.utc(this._a):moment(this._a)).toArray())}return!isNaN(this._d.getTime())},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(inputString){return formatMoment(this,inputString?inputString:moment.defaultFormat)},add:function(input,val){var dur=val?moment.duration(+val,input):moment.duration(input);addOrSubtractDurationFromMoment(this,dur,1);return this},subtract:function(input,val){var dur=val?moment.duration(+val,input):moment.duration(input);addOrSubtractDurationFromMoment(this,dur,-1);return this},diff:function(input,val,asFloat){var inputMoment=this._isUTC?moment(input).utc():moment(input).local(),zoneDiff=(this.zone()-inputMoment.zone())*6e4,diff=this._d-inputMoment._d-zoneDiff,year=this.year()-inputMoment.year(),month=this.month()-inputMoment.month(),date=this.date()-inputMoment.date(),output;if(val==='months'){output=year*12+month+date/30}else if(val==='years'){output=year+(month+date/30)/12}else{output=val==='seconds'?diff/1e3: val==='minutes'?diff/6e4: val==='hours'?diff/36e5: val==='days'?diff/864e5: val==='weeks'?diff/6048e5: diff}return asFloat?output:round(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this._lang).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var diff=this.diff(moment().sod(),'days',true),calendar=this.lang().calendar,allElse=calendar.sameElse,format=diff<-6?allElse:diff<-1?calendar.lastWeek:diff<0?calendar.lastDay:diff<1?calendar.sameDay:diff<2?calendar.nextDay:diff<7?calendar.nextWeek:allElse;return this.format(typeof format==='function'?format.apply(this):format)},isLeapYear:function(){var year=this.year();return(year%4===0&&year%100!==0)||year%400===0},isDST:function(){return(this.zone()<moment([this.year()]).zone()||this.zone()<moment([this.year(),5]).zone())},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return input==null?day:this.add({d:input-day})},startOf:function(val){switch(val.replace(/s$/,'')){case'year':this.month(0);case'month':this.date(1);case'day':this.hours(0);case'hour':this.minutes(0);case'minute':this.seconds(0);case'second':this.milliseconds(0)}return this},endOf:function(val){return this.startOf(val).add(val.replace(/s?$/,'s'),1).subtract('ms',1)},sod:function(){return this.clone().startOf('day')},eod:function(){return this.clone().endOf('day')},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return moment.utc([this.year(),this.month()+1,0]).date()},lang:function(lang){if(lang===undefined){return getLangDefinition(this)}else{this._lang=lang;return this}}};function makeGetterAndSetter(name,key){moment.fn[name]=function(input){var utc=this._isUTC?'UTC':'';if(input!=null){this._d['set'+utc+key](input);return this}else{return this._d['get'+utc+key]()}}}for(i=0;i<proxyGettersAndSetters.length;i++){makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase(),proxyGettersAndSetters[i])}makeGetterAndSetter('year','FullYear');moment.duration.fn=Duration.prototype={weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(withSuffix){var difference=+this,rel=this.lang().relativeTime,output=relativeTime(difference,!withSuffix,this.lang()),fromNow=difference<=0?rel.past:rel.future;if(withSuffix){if(typeof fromNow==='function'){output=fromNow(output)}else{output=fromNow.replace(/%s/i,output)}}return output},lang:moment.fn.lang};function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn['as'+name]=function(){return+this/factor}}for(i in unitMillisecondFactors){if(unitMillisecondFactors.hasOwnProperty(i)){makeDurationAsGetter(i,unitMillisecondFactors[i]);makeDurationGetter(i.toLowerCase())}}makeDurationAsGetter('Weeks',6048e5);if(hasModule){module.exports=moment}if(typeof ender==='undefined'){this['moment']=moment}if(typeof define==="function"&&define.amd){define("moment",[],function(){return moment})}}).call(this);(function(window,undefined){var freeExports=typeof exports=='object'&&exports;var freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal}var arrayRef=[],objectRef={};var idCounter=0;var indicatorObject={};var largeArraySize=30;var oldDash=window._;var reComplexDelimiter=/[-?+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/;var reEscapedHtml=/&(?:amp|lt|gt|quot|#x27);/g;var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reFlags=/\w*$/;var reInsertVariable=/(?:__e|__t = )\(\s*(?![\d\s"']|this\.)/g;var reNative=RegExp('^'+(objectRef.valueOf+'').replace(/[.*+?^=!:${}()|[\]\/\\]/g,'\\$&').replace(/valueOf|for [^\]]+/g,'.+?')+'$');var reNoMatch=/($^)/;var reUnescapedHtml=/[&<>"']/g;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var shadowed=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'];var templateCounter=0;var ceil=Math.ceil,concat=arrayRef.concat,floor=Math.floor,getPrototypeOf=reNative.test(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,hasOwnProperty=objectRef.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectRef.propertyIsEnumerable,slice=arrayRef.slice,toString=objectRef.toString;var nativeBind=reNative.test(nativeBind=slice.bind)&&nativeBind,nativeIsArray=reNative.test(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=window.isFinite,nativeKeys=reNative.test(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeRandom=Math.random;var argsClass='[object Arguments]',arrayClass='[object Array]',boolClass='[object Boolean]',dateClass='[object Date]',funcClass='[object Function]',numberClass='[object Number]',objectClass='[object Object]',regexpClass='[object RegExp]',stringClass='[object String]';var hasDontEnumBug;var iteratesOwnLast;var hasObjectSpliceBug=(hasObjectSpliceBug={'0':1,'length':1},arrayRef.splice.call(hasObjectSpliceBug,0,1),hasObjectSpliceBug[0]);var noArgsEnum=true;(function(){var props=[];function ctor(){this.x=1}ctor.prototype={'valueOf':1,'y':1};for(var prop in new ctor){props.push(prop)}for(prop in arguments){noArgsEnum=!prop}hasDontEnumBug=!/valueOf/.test(props);iteratesOwnLast=props[0]!='x'}(1));var noArgsClass=!isArguments(arguments);var noArraySliceOnStrings=slice.call('x')[0]!='x';var noCharByIndex=('x'[0]+Object('x')[0])!='xx';try{var noNodeClass=({'toString':0}+'',toString.call(window.document||0)==objectClass)}catch(e){}var isBindFast=nativeBind&&/\n|Opera/.test(nativeBind+toString.call(window.opera));var isKeysFast=nativeKeys&&/^.+$|true/.test(nativeKeys+!!window.attachEvent);try{var useSourceURL=(Function('//@')(),!window.attachEvent)}catch(e){}var cloneableClasses={};cloneableClasses[argsClass]=cloneableClasses[funcClass]=false;cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=true;var objectTypes={'boolean':false,'function':true,'object':true,'number':false,'string':false,'undefined':false};var stringEscapes={'\\':'\\',"'":"'",'\n':'n','\r':'r','\t':'t','\u2028':'u2028','\u2029':'u2029'};function lodash(value){if(value&&value.__wrapped__){return value}if(!(this instanceof lodash)){return new lodash(value)}this.__wrapped__=value}lodash.templateSettings={'escape':/<%-([\s\S]+?)%>/g,'evaluate':/<%([\s\S]+?)%>/g,'interpolate':/<%=([\s\S]+?)%>/g,'variable':''};var iteratorTemplate=template('<% if (obj.useStrict) { %>\'use strict\';\n<% } %>'+'var index, value, iteratee = <%= firstArg %>, '+'result = <%= firstArg %>;\n'+'if (!<%= firstArg %>) return result;\n'+'<%= top %>;\n'+'<% if (arrayLoop) { %>'+'var length = iteratee.length; index = -1;\n'+'if (typeof length == \'number\') {'+'  <% if (noCharByIndex) { %>\n'+'  if (toString.call(iteratee) == stringClass) {\n'+'    iteratee = iteratee.split(\'\')\n'+'  }'+'  <% } %>\n'+'  while (++index < length) {\n'+'    value = iteratee[index];\n'+'    <%= arrayLoop %>\n'+'  }\n'+'}\n'+'else {'+'  <%  } else if (noArgsEnum) { %>\n'+'  var length = iteratee.length; index = -1;\n'+'  if (length && isArguments(iteratee)) {\n'+'    while (++index < length) {\n'+'      value = iteratee[index += \'\'];\n'+'      <%= objectLoop %>\n'+'    }\n'+'  } else {'+'  <% } %>'+'  <% if (!hasDontEnumBug) { %>\n'+'  var skipProto = typeof iteratee == \'function\' && \n'+'    propertyIsEnumerable.call(iteratee, \'prototype\');\n'+'  <% } %>'+'  <% if (isKeysFast && useHas) { %>\n'+'  var ownIndex = -1,\n'+'      ownProps = objectTypes[typeof iteratee] ? nativeKeys(iteratee) : [],\n'+'      length = ownProps.length;\n\n'+'  while (++ownIndex < length) {\n'+'    index = ownProps[ownIndex];\n'+'    <% if (!hasDontEnumBug) { %>if (!(skipProto && index == \'prototype\')) {\n  <% } %>'+'    value = iteratee[index];\n'+'    <%= objectLoop %>\n'+'    <% if (!hasDontEnumBug) { %>}\n<% } %>'+'  }'+'  <% } else { %>\n'+'  for (index in iteratee) {<%'+'    if (!hasDontEnumBug || useHas) { %>\n    if (<%'+'      if (!hasDontEnumBug) { %>!(skipProto && index == \'prototype\')<% }'+'      if (!hasDontEnumBug && useHas) { %> && <% }'+'      if (useHas) { %>hasOwnProperty.call(iteratee, index)<% }'+'    %>) {'+'    <% } %>\n'+'    value = iteratee[index];\n'+'    <%= objectLoop %>;'+'    <% if (!hasDontEnumBug || useHas) { %>\n    }<% } %>\n'+'  }'+'  <% } %>'+'  <% if (hasDontEnumBug) { %>\n\n'+'  var ctor = iteratee.constructor;\n'+'    <% for (var k = 0; k < 7; k++) { %>\n'+'  index = \'<%= shadowed[k] %>\';\n'+'  if (<%'+'      if (shadowed[k] == \'constructor\') {'+'        %>!(ctor && ctor.prototype === iteratee) && <%'+'      } %>hasOwnProperty.call(iteratee, index)) {\n'+'    value = iteratee[index];\n'+'    <%= objectLoop %>\n'+'  }'+'    <% } %>'+'  <% } %>'+'  <% if (arrayLoop || noArgsEnum) { %>\n}<% } %>\n'+'<%= bottom %>;\n'+'return result');var forEachIteratorOptions={'args':'collection, callback, thisArg','top':'callback = createCallback(callback, thisArg)','arrayLoop':'if (callback(value, index, collection) === false) return result','objectLoop':'if (callback(value, index, collection) === false) return result'};var extendIteratorOptions={'useHas':false,'args':'object','top':'for (var argsIndex = 1, argsLength = arguments.length; argsIndex < argsLength; argsIndex++) {\n'+'  if (iteratee = arguments[argsIndex]) {','objectLoop':'result[index] = value','bottom':'  }\n}'};var forOwnIteratorOptions={'arrayLoop':null};function cachedContains(array,fromIndex,largeSize){fromIndex||(fromIndex=0);var length=array.length,isLarge=(length-fromIndex)>=(largeSize||largeArraySize),cache=isLarge?{}:array;if(isLarge){var index=fromIndex-1;while(++index<length){var key=array[index]+'';(hasOwnProperty.call(cache,key)?cache[key]:(cache[key]=[])).push(array[index])}}return function(value){if(isLarge){var key=value+'';return hasOwnProperty.call(cache,key)&&indexOf(cache[key],value)>-1}return indexOf(cache,value,fromIndex)>-1}}function compareAscending(a,b){var ai=a.index,bi=b.index;a=a.criteria;b=b.criteria;if(a!==b){if(a>b||a===undefined){return 1}if(a<b||b===undefined){return-1}}return ai<bi?-1:1}function createBound(func,thisArg,partialArgs){var isFunc=isFunction(func),isPartial=!partialArgs,methodName=func;if(isPartial){partialArgs=thisArg}function bound(){var args=arguments,thisBinding=isPartial?this:thisArg;if(!isFunc){func=thisArg[methodName]}if(partialArgs.length){args=args.length?partialArgs.concat(slice.call(args)):partialArgs}if(this instanceof bound){noop.prototype=func.prototype;thisBinding=new noop;var result=func.apply(thisBinding,args);return result&&objectTypes[typeof result]?result:thisBinding}return func.apply(thisBinding,args)}return bound}function createCallback(func,thisArg){if(!func){return identity}if(typeof func!='function'){return function(object){return object[func]}}if(thisArg!==undefined){return function(value,index,object){return func.call(thisArg,value,index,object)}}return func}function createIterator(){var data={'arrayLoop':'','bottom':'','hasDontEnumBug':hasDontEnumBug,'isKeysFast':isKeysFast,'objectLoop':'','noArgsEnum':noArgsEnum,'noCharByIndex':noCharByIndex,'shadowed':shadowed,'top':'','useHas':true};for(var object,index=0;object=arguments[index];index++){for(var key in object){data[key]=object[key]}}var args=data.args;data.firstArg=/^[^,]+/.exec(args)[0];var factory=Function('createCallback, hasOwnProperty, isArguments, objectTypes, nativeKeys, '+'propertyIsEnumerable, stringClass, toString','return function('+args+') {\n'+iteratorTemplate(data)+'\n}');return factory(createCallback,hasOwnProperty,isArguments,objectTypes,nativeKeys,propertyIsEnumerable,stringClass,toString)}function escapeStringChar(match){return'\\'+stringEscapes[match]}function escapeHtmlChar(match){return htmlEscapes[match]}function noop(){}function unescapeHtmlChar(match){return htmlUnescapes[match]}function isArguments(value){return toString.call(value)==argsClass}if(noArgsClass){isArguments=function(value){return value?hasOwnProperty.call(value,'callee'):false}}var forIn=createIterator(forEachIteratorOptions,forOwnIteratorOptions,{'useHas':false});var forOwn=createIterator(forEachIteratorOptions,forOwnIteratorOptions);function shimIsPlainObject(value){var result=false;if(!(value&&typeof value=='object')||isArguments(value)){return result}var ctor=value.constructor;if((!noNodeClass||!(typeof value.toString!='function'&&typeof(value+'')=='string'))&&(!isFunction(ctor)||ctor instanceof ctor)){if(iteratesOwnLast){forIn(value,function(value,key,object){result=!hasOwnProperty.call(object,key);return false});return result===false}forIn(value,function(value,key){result=key});return result===false||hasOwnProperty.call(value,result)}return result}function shimKeys(object){var result=[];forOwn(object,function(value,key){result.push(key)});return result}var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;'};var htmlUnescapes=invert(htmlEscapes);function clone(value,deep,guard,stackA,stackB){if(value==null){return value}if(guard){deep=false}var isObj=objectTypes[typeof value];if(isObj){var className=toString.call(value);if(!cloneableClasses[className]||(noArgsClass&&isArguments(value))){return value}var isArr=className==arrayClass;isObj=isArr||(className==objectClass?isPlainObject(value):isObj)}if(!isObj||!deep){return isObj?(isArr?slice.call(value):extend({},value)):value}var ctor=value.constructor;switch(className){case boolClass:case dateClass:return new ctor(+value);case numberClass:case stringClass:return new ctor(value);case regexpClass:return ctor(value.source,reFlags.exec(value))}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length]}}var result=isArr?ctor(value.length):{};stackA.push(value);stackB.push(result);(isArr?forEach:forOwn)(value,function(objValue,key){result[key]=clone(objValue,deep,null,stackA,stackB)});return result}var defaults=createIterator(extendIteratorOptions,{'objectLoop':'if (result[index] == null) '+extendIteratorOptions.objectLoop});var extend=createIterator(extendIteratorOptions);function functions(object){var result=[];forIn(object,function(value,key){if(isFunction(value)){result.push(key)}});return result.sort()}function has(object,property){return object?hasOwnProperty.call(object,property):false}function invert(object){var result={};forOwn(object,function(value,key){result[value]=key});return result}var isArray=nativeIsArray||function(value){return toString.call(value)==arrayClass};function isBoolean(value){return value===true||value===false||toString.call(value)==boolClass}function isDate(value){return toString.call(value)==dateClass}function isElement(value){return value?value.nodeType===1:false}function isEmpty(value){var result=true;if(!value){return result}var className=toString.call(value),length=value.length;if((className==arrayClass||className==stringClass||className==argsClass||(noArgsClass&&isArguments(value)))||(className==objectClass&&typeof length=='number'&&isFunction(value.splice))){return!length}forOwn(value,function(){return(result=false)});return result}function isEqual(a,b,stackA,stackB){if(a===b){return a!==0||(1/a==1/b)}if(a==null||b==null){return a===b}var className=toString.call(a);if(className!=toString.call(b)){return false}switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:(a==0?(1/a==1/b):a==+b);case regexpClass:case stringClass:return a==b+''}var isArr=className==arrayClass||className==argsClass;if(noArgsClass&&!isArr&&(isArr=isArguments(a))&&!isArguments(b)){return false}if(!isArr){if(a.__wrapped__||b.__wrapped__){return isEqual(a.__wrapped__||a,b.__wrapped__||b)}if(className!=objectClass||(noNodeClass&&((typeof a.toString!='function'&&typeof(a+'')=='string')||(typeof b.toString!='function'&&typeof(b+'')=='string')))){return false}var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)){return false}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b}}var index=-1,result=true,size=0;stackA.push(a);stackB.push(b);if(isArr){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=isEqual(a[size],b[size],stackA,stackB))){break}}}return result}for(var key in a){if(hasOwnProperty.call(a,key)){size++;if(!(hasOwnProperty.call(b,key)&&isEqual(a[key],b[key],stackA,stackB))){return false}}}for(key in b){if(hasOwnProperty.call(b,key)&&!(size--)){return false}}if(hasDontEnumBug){while(++index<7){key=shadowed[index];if(hasOwnProperty.call(a,key)&&!(hasOwnProperty.call(b,key)&&isEqual(a[key],b[key],stackA,stackB))){return false}}}return true}function isFinite(value){return nativeIsFinite(value?+value:parseFloat(value))}function isFunction(value){return typeof value=='function'}if(isFunction(/x/)){isFunction=function(value){return toString.call(value)==funcClass}}function isObject(value){return value?objectTypes[typeof value]:false}function isNaN(value){return toString.call(value)==numberClass&&value!=+value}function isNull(value){return value===null}function isNumber(value){return toString.call(value)==numberClass}var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&typeof value=='object')){return false}var valueOf=value.valueOf,objProto=typeof valueOf=='function'&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||(getPrototypeOf(value)==objProto&&!isArguments(value)):shimIsPlainObject(value)};function isRegExp(value){return toString.call(value)==regexpClass}function isString(value){return toString.call(value)==stringClass}function isUndefined(value){return value===undefined}var keys=!nativeKeys?shimKeys:function(object){var type=typeof object;if(type=='function'&&propertyIsEnumerable.call(object,'prototype')){return shimKeys(object)}return object&&objectTypes[type]?nativeKeys(object):[]};function merge(object,source,indicator){var args=arguments,index=0,length=2,stackA=args[3],stackB=args[4];if(indicator!==indicatorObject){stackA=[];stackB=[];length=args.length}while(++index<length){forOwn(args[index],function(source,key){var found,isArr,value;if(source&&((isArr=isArray(source))||isPlainObject(source))){var stackLength=stackA.length;while(stackLength--){found=stackA[stackLength]==source;if(found){break}}if(found){object[key]=stackB[stackLength]}else{stackA.push(source);stackB.push(value=(value=object[key],isArr)?(isArray(value)?value:[]):(isPlainObject(value)?value:{}));object[key]=merge(value,source,indicatorObject,stackA,stackB)}}else if(source!=null){object[key]=source}})}return object}function omit(object,callback,thisArg){var isFunc=typeof callback=='function',result={};if(isFunc){callback=createCallback(callback,thisArg)}else{var props=concat.apply(arrayRef,arguments)}forIn(object,function(value,key,object){if(isFunc?!callback(value,key,object):indexOf(props,key,1)<0){result[key]=value}});return result}function pairs(object){var result=[];forOwn(object,function(value,key){result.push([key,value])});return result}function pick(object,callback,thisArg){var result={};if(typeof callback!='function'){var index=0,props=concat.apply(arrayRef,arguments),length=props.length;while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}}else{callback=createCallback(callback,thisArg);forIn(object,function(value,key,object){if(callback(value,key,object)){result[key]=value}})}return result}function values(object){var result=[];forOwn(object,function(value){result.push(value)});return result}function contains(collection,target){var length=collection?collection.length:0;if(typeof length=='number'){return(toString.call(collection)==stringClass?collection.indexOf(target):indexOf(collection,target))>-1}return some(collection,function(value){return value===target})}function countBy(collection,callback,thisArg){var result={};callback=createCallback(callback,thisArg);forEach(collection,function(value,key,collection){key=callback(value,key,collection);(hasOwnProperty.call(result,key)?result[key]++:result[key]=1)});return result}function every(collection,callback,thisArg){var result=true;callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){return(result=callback(value,index,collection))});return!!result}function filter(collection,callback,thisArg){var result=[];callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){if(callback(value,index,collection)){result.push(value)}});return result}function find(collection,callback,thisArg){var result;callback=createCallback(callback,thisArg);some(collection,function(value,index,collection){return callback(value,index,collection)&&(result=value,true)});return result}var forEach=createIterator(forEachIteratorOptions);function groupBy(collection,callback,thisArg){var result={};callback=createCallback(callback,thisArg);forEach(collection,function(value,key,collection){key=callback(value,key,collection);(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value)});return result}function invoke(collection,methodName){var args=slice.call(arguments,2),isFunc=typeof methodName=='function',result=[];forEach(collection,function(value){result.push((isFunc?methodName:value[methodName]).apply(value,args))});return result}function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);callback=createCallback(callback,thisArg);if(isArray(collection)){while(++index<length){result[index]=callback(collection[index],index,collection)}}else{forEach(collection,function(value,key,collection){result[++index]=callback(value,key,collection)})}return result}function max(collection,callback,thisArg){var computed=-Infinity,index=-1,length=collection?collection.length:0,result=computed;if(callback||typeof length!='number'){callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value}})}else{while(++index<length){if(collection[index]>result){result=collection[index]}}}return result}function min(collection,callback,thisArg){var computed=Infinity,index=-1,length=collection?collection.length:0,result=computed;if(callback||typeof length!='number'){callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current<computed){computed=current;result=value}})}else{while(++index<length){if(collection[index]<result){result=collection[index]}}}return result}function pluck(collection,property){var result=[];forEach(collection,function(value){result.push(value[property])});return result}function reduce(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection)});return accumulator}function reduceRight(collection,callback,accumulator,thisArg){var iteratee=collection,length=collection?collection.length:0,noaccum=arguments.length<3;if(typeof length!='number'){var props=keys(collection);length=props.length}else if(noCharByIndex&&toString.call(collection)==stringClass){iteratee=collection.split('')}forEach(collection,function(value,index,collection){index=props?props[--length]:--length;accumulator=noaccum?(noaccum=false,iteratee[index]):callback.call(thisArg,accumulator,iteratee[index],index,collection)});return accumulator}function reject(collection,callback,thisArg){callback=createCallback(callback,thisArg);return filter(collection,function(value,index,collection){return!callback(value,index,collection)})}function shuffle(collection){var index=-1,result=Array(collection?collection.length:0);forEach(collection,function(value){var rand=floor(nativeRandom()*(++index+1));result[index]=result[rand];result[rand]=value});return result}function size(collection){var length=collection?collection.length:0;return typeof length=='number'?length:keys(collection).length}function some(collection,callback,thisArg){var result;callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){return!(result=callback(value,index,collection))});return!!result}function sortBy(collection,callback,thisArg){var result=[];callback=createCallback(callback,thisArg);forEach(collection,function(value,index,collection){result.push({'criteria':callback(value,index,collection),'index':index,'value':value})});var length=result.length;result.sort(compareAscending);while(length--){result[length]=result[length].value}return result}function toArray(collection){if(collection&&typeof collection.length=='number'){return(noArraySliceOnStrings?toString.call(collection)==stringClass:typeof collection=='string')?collection.split(''):slice.call(collection)}return values(collection)}function where(collection,properties){var props=[];forIn(properties,function(value,prop){props.push(prop)});return filter(collection,function(object){var length=props.length;while(length--){var result=object[props[length]]===properties[props[length]];if(!result){break}}return!!result})}function compact(array){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value){result.push(value)}}return result}function difference(array){var index=-1,length=array?array.length:0,flattened=concat.apply(arrayRef,arguments),contains=cachedContains(flattened,length),result=[];while(++index<length){var value=array[index];if(!contains(value)){result.push(value)}}return result}function first(array,n,guard){if(array){return(n==null||guard)?array[0]:slice.call(array,0,n)}}function flatten(array,shallow){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(isArray(value)){push.apply(result,shallow?value:flatten(value))}else{result.push(value)}}return result}function indexOf(array,value,fromIndex){var index=-1,length=array?array.length:0;if(typeof fromIndex=='number'){index=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0)-1}else if(fromIndex){index=sortedIndex(array,value);return array[index]===value?index:-1}while(++index<length){if(array[index]===value){return index}}return-1}function initial(array,n,guard){return array?slice.call(array,0,-((n==null||guard)?1:n)):[]}function intersection(array){var args=arguments,argsLength=args.length,cache={},result=[];forEach(array,function(value){if(indexOf(result,value)<0){var length=argsLength;while(--length){if(!(cache[length]||(cache[length]=cachedContains(args[length])))(value)){return}}result.push(value)}});return result}function last(array,n,guard){if(array){var length=array.length;return(n==null||guard)?array[length-1]:slice.call(array,-n||length)}}function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;if(typeof fromIndex=='number'){index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1}while(index--){if(array[index]===value){return index}}return-1}function object(keys,values){var index=-1,length=keys?keys.length:0,result={};while(++index<length){var key=keys[index];if(values){result[key]=values[index]}else{result[key[0]]=key[1]}}return result}function range(start,end,step){start=+start||0;step=+step||1;if(end==null){end=start;start=0}var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);while(++index<length){result[index]=start;start+=step}return result}function rest(array,n,guard){return array?slice.call(array,(n==null||guard)?1:n):[]}function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?createCallback(callback,thisArg):identity;value=callback(value);while(low<high){var mid=(low+high)>>>1;callback(array[mid])<value?low=mid+1:high=mid}return low}function union(){var index=-1,flattened=concat.apply(arrayRef,arguments),length=flattened.length,result=[];while(++index<length){var value=flattened[index];if(indexOf(result,value)<0){result.push(value)}}return result}function uniq(array,isSorted,callback,thisArg){var index=-1,length=array?array.length:0,result=[],seen=[];if(typeof isSorted=='function'){thisArg=callback;callback=isSorted;isSorted=false}callback=createCallback(callback,thisArg);while(++index<length){var computed=callback(array[index],index,array);if(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0){seen.push(computed);result.push(array[index])}}return result}function without(array){var index=-1,length=array?array.length:0,contains=cachedContains(arguments,1,20),result=[];while(++index<length){var value=array[index];if(!contains(value)){result.push(value)}}return result}function zip(array){var index=-1,length=array?max(pluck(arguments,'length')):0,result=Array(length);while(++index<length){result[index]=pluck(arguments,index)}return result}function after(n,func){if(n<1){return func()}return function(){if(--n<1){return func.apply(this,arguments)}}}function bind(func,thisArg){return isBindFast||(nativeBind&&arguments.length>2)?nativeBind.call.apply(nativeBind,arguments):createBound(func,thisArg,slice.call(arguments,2))}function bindAll(object){var funcs=arguments,index=funcs.length>1?0:(funcs=functions(object),-1),length=funcs.length;while(++index<length){var key=funcs[index];object[key]=bind(object[key],object)}return object}function compose(){var funcs=arguments;return function(){var args=arguments,length=funcs.length;while(length--){args=[funcs[length].apply(this,args)]}return args[0]}}function debounce(func,wait,immediate){var args,result,thisArg,timeoutId;function delayed(){timeoutId=null;if(!immediate){result=func.apply(thisArg,args)}}return function(){var isImmediate=immediate&&!timeoutId;args=arguments;thisArg=this;clearTimeout(timeoutId);timeoutId=setTimeout(delayed,wait);if(isImmediate){result=func.apply(thisArg,args)}return result}}function delay(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){func.apply(undefined,args)},wait)}function defer(func){var args=slice.call(arguments,1);return setTimeout(function(){func.apply(undefined,args)},1)}function lateBind(object,methodName){return createBound(methodName,object,slice.call(arguments,2))}function memoize(func,resolver){var cache={};return function(){var key=resolver?resolver.apply(this,arguments):arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:(cache[key]=func.apply(this,arguments))}}function once(func){var result,ran=false;return function(){if(ran){return result}ran=true;result=func.apply(this,arguments);func=null;return result}}function partial(func){return createBound(func,slice.call(arguments,1))}function throttle(func,wait){var args,result,thisArg,timeoutId,lastCalled=0;function trailingCall(){lastCalled=new Date;timeoutId=null;result=func.apply(thisArg,args)}return function(){var now=new Date,remaining=wait-(now-lastCalled);args=arguments;thisArg=this;if(remaining<=0){clearTimeout(timeoutId);lastCalled=now;result=func.apply(thisArg,args)}else if(!timeoutId){timeoutId=setTimeout(trailingCall,remaining)}return result}}function wrap(value,wrapper){return function(){var args=[value];push.apply(args,arguments);return wrapper.apply(this,args)}}function escape(string){return string==null?'':(string+'').replace(reUnescapedHtml,escapeHtmlChar)}function identity(value){return value}function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);var result=func.apply(lodash,args);if(this.__chain__){result=new lodash(result);result.__chain__=true}return result}})}function noConflict(){window._=oldDash;return this}function random(min,max){if(min==null&&max==null){max=1}min=+min||0;if(max==null){max=min;min=0}return min+floor(nativeRandom()*((+max||0)-min+1))}function result(object,property){var value=object?object[property]:null;return isFunction(value)?object[property]():value}function template(text,data,options){text||(text='');options||(options={});var isEvaluating,result,index=0,settings=lodash.templateSettings,source="__p += '",variable=options.variable||settings.variable,hasVariable=variable;var reDelimiters=RegExp((options.escape||settings.escape||reNoMatch).source+'|'+(options.interpolate||settings.interpolate||reNoMatch).source+'|'+(options.evaluate||settings.evaluate||reNoMatch).source+'|$','g');text.replace(reDelimiters,function(match,escapeValue,interpolateValue,evaluateValue,offset){source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);source+=escapeValue?"' +\n__e("+escapeValue+") +\n'":evaluateValue?"';\n"+evaluateValue+";\n__p += '":interpolateValue?"' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'":'';isEvaluating||(isEvaluating=evaluateValue||reComplexDelimiter.test(escapeValue||interpolateValue));index=offset+match.length});source+="';\n";if(!hasVariable){variable='obj';if(isEvaluating){source='with ('+variable+') {\n'+source+'\n}\n'}else{var reDoubleVariable=RegExp('(\\(\\s*)'+variable+'\\.'+variable+'\\b','g');source=source.replace(reInsertVariable,'$&'+variable+'.').replace(reDoubleVariable,'$1__d')}}source=(isEvaluating?source.replace(reEmptyStringLeading,''):source).replace(reEmptyStringMiddle,'$1').replace(reEmptyStringTrailing,'$1;');source='function('+variable+') {\n'+(hasVariable?'':variable+' || ('+variable+' = {});\n')+'var __t, __p = \'\', __e = _.escape'+(isEvaluating?', __j = Array.prototype.join;\n'+'function print() { __p += __j.call(arguments, \'\') }\n':(hasVariable?'':', __d = '+variable+'.'+variable+' || '+variable)+';\n')+source+'return __p\n}';var sourceURL=useSourceURL?'\n//@ sourceURL='+(options.sourceURL||'/lodash/template/source['+(templateCounter++)+']'):'';try{result=Function('_','return '+source+sourceURL)(lodash)}catch(e){e.source=source;throw e}if(data){return result(data)}result.source=source;return result}function times(n,callback,thisArg){n=+n||0;var index=-1,result=Array(n);while(++index<n){result[index]=callback.call(thisArg,index)}return result}function unescape(string){return string==null?'':(string+'').replace(reEscapedHtml,unescapeHtmlChar)}function uniqueId(prefix){var id=idCounter++;return prefix?prefix+id:id}function chain(value){value=new lodash(value);value.__chain__=true;return value}function tap(value,interceptor){interceptor(value);return value}function wrapperChain(){this.__chain__=true;return this}function wrapperValue(){return this.__wrapped__}lodash.VERSION='0.9.0';lodash.after=after;lodash.bind=bind;lodash.bindAll=bindAll;lodash.chain=chain;lodash.clone=clone;lodash.compact=compact;lodash.compose=compose;lodash.contains=contains;lodash.countBy=countBy;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.escape=escape;lodash.every=every;lodash.extend=extend;lodash.filter=filter;lodash.find=find;lodash.first=first;lodash.flatten=flatten;lodash.forEach=forEach;lodash.forIn=forIn;lodash.forOwn=forOwn;lodash.functions=functions;lodash.groupBy=groupBy;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.keys=keys;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lateBind=lateBind;lodash.map=map;lodash.max=max;lodash.memoize=memoize;lodash.merge=merge;lodash.min=min;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.object=object;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.pick=pick;lodash.pluck=pluck;lodash.random=random;lodash.range=range;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.reject=reject;lodash.rest=rest;lodash.result=result;lodash.shuffle=shuffle;lodash.size=size;lodash.some=some;lodash.sortBy=sortBy;lodash.sortedIndex=sortedIndex;lodash.tap=tap;lodash.template=template;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.unescape=unescape;lodash.union=union;lodash.uniq=uniq;lodash.uniqueId=uniqueId;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.zip=zip;lodash.all=every;lodash.any=some;lodash.collect=map;lodash.detect=find;lodash.drop=rest;lodash.each=forEach;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.head=first;lodash.include=contains;lodash.inject=reduce;lodash.methods=functions;lodash.select=filter;lodash.tail=rest;lodash.take=first;lodash.unique=uniq;lodash._iteratorTemplate=iteratorTemplate;mixin(lodash);lodash.prototype.chain=wrapperChain;lodash.prototype.value=wrapperValue;forEach(['pop','push','reverse','shift','sort','splice','unshift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__;func.apply(value,arguments);if(hasObjectSpliceBug&&value.length===0){delete value[0]}if(this.__chain__){value=new lodash(value);value.__chain__=true}return value}});forEach(['concat','join','slice'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,result=func.apply(value,arguments);if(this.__chain__){result=new lodash(result);result.__chain__=true}return result}});if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){window._=lodash;define(function(){return lodash})}else if(freeExports){if(typeof module=='object'&&module&&module.exports==freeExports){(module.exports=lodash)._=lodash}else{freeExports._=lodash}}else{window._=lodash}}(this));var JSON;if(!JSON){JSON={}}(function(){'use strict';function f(n){return n<10?'0'+n:n}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key)}if(typeof rep==='function'){value=rep.call(holder,key,value)}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null'}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null'}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v}}if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' '}}else if(typeof space==='string'){indent=space}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify')}return str('',{'':value})}}if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j}throw new SyntaxError('JSON.parse')}}}());(function(){var math=this.math={};math.mean=math.ave=math.average=function(obj,key){return math.sum(obj,key)/_(obj).size()};math.median=function(arr){var middle=(arr.length+1)/2;var sorted=math.sort(arr);return(sorted.length%2)?sorted[middle-1]:(sorted[middle-1.5]+sorted[middle-0.5])/2};math.pow=function(x,n){if(_.isNumber(x))return Math.pow(x,n);if(_.isArray(x))return _.map(x,function(i){return _.pow(i,n)})};math.scale=function(arr,max){var max=max||1;var max0=_.max(arr);return _.map(arr,function(i){return i*(max/max0)})};math.slope=function(x,y){return(y[1]-x[1])/(y[0]-x[0])};math.sort=function(arr){return arr.sort(function(a,b){return a-b})};math.stdDeviation=math.sigma=function(arr){return Math.sqrt(_(arr).variance())};math.sum=function(obj,key){if(_.isArray(obj)&&typeof obj[0]==='number'){var arr=obj}else{var key=key||'value';var arr=_(obj).pluck(key)}var val=0;for(var i=0,len=arr.length;i<len;i++)val+=arr[i];return val};math.transpose=function(arr){var trans=[];_(arr).each(function(row,y){_(row).each(function(col,x){if(!trans[x])trans[x]=[];trans[x][y]=col})});return trans};math.variance=function(arr){var mean=_(arr).mean();return _(arr).chain().map(function(x){return _(x-mean).pow(2)}).mean().value()};_.mixin(math)})();(function(root){var breaker={},AP=Array.prototype,OP=Object.prototype,hasOwn=OP.hasOwnProperty,toString=OP.toString,forEach=AP.forEach,indexOf=AP.indexOf,slice=AP.slice;var _each=function(obj,iterator,context){var key,i,l;if(!obj){return}if(forEach&&obj.forEach===forEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker){return}}}else{for(key in obj){if(hasOwn.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker){return}}}}};var _isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply)};var _extend=function(obj){_each(slice.call(arguments,1),function(source){var prop;for(prop in source){if(source[prop]!==void 0){obj[prop]=source[prop]}}});return obj};var _inArray=function(elem,arr,i){var len;if(arr){if(indexOf){return indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return-1};var class2type={};_each("Boolean Number String Function Array Date RegExp Object".split(" "),function(name,i){class2type["[object "+name+"]"]=name.toLowerCase()});var _type=function(obj){return obj==null?String(obj):class2type[toString.call(obj)]||"object"};var _d={};var optionsCache={};function createOptions(options){var object=optionsCache[options]={};_each(options.split(/\s+/),function(flag){object[flag]=true});return object}_d.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):_extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){_each(args,function(arg){var type=_type(arg);if(type==="function"&&(!options.unique||!self.has(arg))){list.push(arg)}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){_each(arguments,function(arg){var index;while((index=_inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return _inArray(fn,list)>-1},empty:function(){list=[];return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};_d.Deferred=function(func){var tuples=[["resolve","done",_d.Callbacks("once memory"),"resolved"],["reject","fail",_d.Callbacks("once memory"),"rejected"],["notify","progress",_d.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return _d.Deferred(function(newDefer){_each(tuples,function(tuple,i){var action=tuple[0],fn=fns[i];deferred[tuple[1]](_isFunction(fn)?function(){var returned=fn.apply(this,arguments);if(returned&&_isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned])}}:newDefer[action])});fns=null}).promise()},promise:function(obj){return typeof obj==="object"?_extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;_each(tuples,function(tuple,i){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=list.fire;deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred};_d.when=function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&_isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:_d.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!(--remaining)){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&_isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()};if(typeof module!=="undefined"&&module.exports){module.exports=_d}else if(typeof root._!=="undefined"){root._.mixin(_d)}else{root._=_d}})(this);(function(global,_){var Miso=global.Miso=(global.Miso||{});Miso.Events={publish:function(name){var args=_.toArray(arguments);args.shift();if(this._events&&this._events[name]){_.each(this._events[name],function(subscription){subscription.callback.apply(subscription.context||this,args)},this)}return this},subscribe:function(name,callback,options){options=options||{};this._events=this._events||{};this._events[name]=this._events[name]||[];var subscription={callback:callback,priority:options.priority||0,token:options.token||_.uniqueId('t'),context:options.context||this};var position;_.each(this._events[name],function(event,index){if(!_.isUndefined(position)){return}if(event.priority<=subscription.priority){position=index}});this._events[name].splice(position,0,subscription);return subscription.token},subscribeOnce:function(name,callback,options){this._events=this._events||{};options=options||{};var self=this;if(typeof options.token==="undefined"){options.token=_.uniqueId('t')}return this.subscribe(name,function(){self.unsubscribe(name,{token:options.token});callback.apply(this,arguments)},options)},unsubscribe:function(name,identifier){if(_.isUndefined(this._events[name])){return this}if(_.isFunction(identifier)){this._events[name]=_.reject(this._events[name],function(b){return b.callback===identifier})}else if(_.isString(identifier)){this._events[name]=_.reject(this._events[name],function(b){return b.token===identifier})}else{this._events[name]=[]}return this}}}(this,_));(function(global){global.Miso=global.Miso||{};global.Miso.Dataset=function(options){options=options||{};this.length=0;this._columns=[];this._columnPositionByName={};this._computedColumns=[];this._initialize(options)}}(this));(function(global,_){var Miso=global.Miso||(global.Miso={});var Dataset=global.Miso.Dataset;Dataset.Column=function(options){_.extend(this,options);this._id=options.id||_.uniqueId();this.data=options.data||[];return this};_.extend(Dataset.Column.prototype,{toNumeric:function(value){return Dataset.types[this.type].numeric(value)},numericAt:function(index){return this.toNumeric(this.data[index])},coerce:function(){this.data=_.map(this.data,function(datum){return Dataset.types[this.type].coerce(datum,this)},this)},compute:function(row,i){if(this.func){var val=this.func(row);if(typeof i!=="undefined"){this.data[i]=val}else{this.data.push(val)}return val}},isComputed:function(){return!_.isUndefined(this.func)},_sum:function(){return _.sum(this.data)},_mean:function(){var m=0;for(var j=0;j<this.data.length;j++){m+=this.numericAt(j)}m/=this.data.length;return Dataset.types[this.type].coerce(m,this)},_median:function(){return Dataset.types[this.type].coerce(_.median(this.data),this)},_max:function(){var max=-Infinity;for(var j=0;j<this.data.length;j++){if(this.data[j]!==null){if(Dataset.types[this.type].compare(this.data[j],max)>0){max=this.numericAt(j)}}}return Dataset.types[this.type].coerce(max,this)},_min:function(){var min=Infinity;for(var j=0;j<this.data.length;j++){if(this.data[j]!==null){if(Dataset.types[this.type].compare(this.data[j],min)<0){min=this.numericAt(j)}}}return Dataset.types[this.type].coerce(min,this)}});Dataset.DataView=function(options){if(typeof options!=="undefined"){options=options||(options={});if(_.isUndefined(options.parent)){throw new Error("A view must have a parent specified.")}this.parent=options.parent;this._initialize(options)}};_.extend(Dataset.DataView.prototype,{_initialize:function(options){if(this.parent.syncable===true){_.extend(this,Miso.Events);this.syncable=true}this.idAttribute=this.parent.idAttribute;this.filter={};this.filter.columns=_.bind(this._columnFilter(options.filter.columns||undefined),this);this.filter.rows=_.bind(this._rowFilter(options.filter.rows||undefined),this);this._columns=this._selectData();Dataset.Builder.cacheColumns(this);Dataset.Builder.cacheRows(this);if(this.syncable){this.parent.subscribe("change",this._sync,{context:this})}},_sync:function(event){var deltas=event.deltas,eventType=null;_.each(deltas,function(d,deltaIndex){var rowPos=this._rowPositionById[d[this.idAttribute]];if(typeof rowPos==="undefined"&&Dataset.Event.isAdd(d)){if(this.filter.rows&&this.filter.rows(d.changed)){this._add(d.changed);eventType="add"}}else{if(rowPos==="undefined"){return}_.each(d.changed,function(newValue,columnName){var colPos=this._columnPositionByName[columnName];if(_.isUndefined(colPos)){return}this._columns[colPos].data[rowPos]=newValue;eventType="update"},this)}var row=this.rowByPosition(rowPos);if(Dataset.Event.isRemove(d)||(this.filter.row&&!this.filter.row(row))){var newDelta={old:this.rowByPosition(rowPos),changed:{}};newDelta[this.idAttribute]=d[this.idAttribute];event.deltas.splice(deltaIndex,1,newDelta);this._remove(rowPos);eventType="delete"}},this);if(this.syncable){this.publish(eventType,event);this.publish("change",event)}},where:function(filter,options){options=options||{};options.filter=options.filter||{};if(_.isFunction(filter)){options.filter.rows=filter}else{options.filter=filter}options.parent=this;return new Dataset.DataView(options)},_selectData:function(){var selectedColumns=[];_.each(this.parent._columns,function(parentColumn){if(this.filter.columns(parentColumn)){selectedColumns.push(new Dataset.Column({name:parentColumn.name,data:[],type:parentColumn.type,_id:parentColumn._id}))}},this);this.parent.each(function(row){if(!this.filter.rows(row)){return}for(var i=0;i<selectedColumns.length;i++){selectedColumns[i].data.push(row[selectedColumns[i].name])}},this);return selectedColumns},_columnFilter:function(columnFilter){var columnSelector;if(_.isUndefined(columnFilter)){columnSelector=function(){return true}}else{if(_.isString(columnFilter)){columnFilter=[columnFilter]}columnFilter.push(this.idAttribute);columnSelector=function(column){return _.indexOf(columnFilter,column.name)===-1?false:true}}return columnSelector},_rowFilter:function(rowFilter){var rowSelector;if(_.isNumber(rowFilter)){rowFilter=[rowFilter]}if(_.isUndefined(rowFilter)){rowSelector=function(){return true}}else if(_.isFunction(rowFilter)){rowSelector=rowFilter}else{rowSelector=_.bind(function(row){return _.indexOf(rowFilter,row[this.idAttribute])===-1?false:true},this)}return rowSelector},column:function(name){return this._column(name)},_column:function(name){if(_.isUndefined(this._columnPositionByName)){return undefined}var pos=this._columnPositionByName[name];return this._columns[pos]},columns:function(columnsArray){return new Dataset.DataView({filter:{columns:columnsArray},parent:this})},columnNames:function(){var cols=_.pluck(this._columns,'name');return _.reject(cols,function(colName){return colName===this.idAttribute||colName==='_oids'},this)},hasColumn:function(name){return(!_.isUndefined(this._columnPositionByName[name]))},each:function(iterator,context){for(var i=0;i<this.length;i++){iterator.apply(context||this,[this.rowByPosition(i),i])}},reverseEach:function(iterator,context){for(var i=this.length-1;i>=0;i--){iterator.apply(context||this,[this.rowByPosition(i),i])}},eachColumn:function(iterator,context){var cols=this.columnNames();for(var i=0;i<cols.length;i++){iterator.apply(context||this,[cols[i],this.column(cols[i]),i])}},rowByPosition:function(i){return this._row(i)},rowById:function(id){return this._row(this._rowPositionById[id])},_row:function(pos){var row={};_.each(this._columns,function(column){row[column.name]=column.data[pos]});return row},_remove:function(rowId){var rowPos=this._rowPositionById[rowId];_.each(this._columns,function(column){column.data.splice(rowPos,1)});delete this._rowPositionById[rowId];this._rowIdByPosition.splice(rowPos,1);this.length--;return this},_add:function(row){_.each(row,function(value,key){var column=this.column(key);if(column.isComputed()){throw"You're trying to update a computed column. Those get computed!"}if(typeof column!=="undefined"){var Type=Dataset.types[column.type];if(column.force||Type.test(row[column.name],column)){if(!_.isUndefined(column.before)){row[column.name]=column.before(row[column.name])}row[column.name]=Type.coerce(row[column.name],column)}else{throw("incorrect value '"+row[column.name]+"' of type "+Dataset.typeOf(row[column.name],column)+" passed to column '"+column.name+"' with type "+column.type)}}},this);if(this._computedColumns){_.each(this._computedColumns,function(column){var newVal=column.compute(row);row[column.name]=newVal})}if(_.isUndefined(this.comparator)){_.each(this._columns,function(column){if(!column.isComputed()){column.data.push(!_.isUndefined(row[column.name])&&!_.isNull(row[column.name])?row[column.name]:null)}});this.length++;this._rowIdByPosition=this._rowIdByPosition||(this._rowIdByPosition=[]);this._rowPositionById=this._rowPositionById||(this._rowPositionById={});if(typeof this._rowPositionById[row[this.idAttribute]]!=="undefined"){throw"The id "+row[this.idAttribute]+" is not unique. The "+this.idAttribute+" column must be unique"}this._rowPositionById[row[this.idAttribute]]=this._rowIdByPosition.length;this._rowIdByPosition.push(row[this.idAttribute])}else{var insertAt=function(at,value,into){Array.prototype.splice.apply(into,[at,0].concat(value))};var i;this.length++;for(i=0;i<this.length;i++){var row2=this.rowByPosition(i);if(_.isUndefined(row2[this.idAttribute])||this.comparator(row,row2)<0){_.each(this._columns,function(column){insertAt(i,(row[column.name]?row[column.name]:null),column.data)});break}}this._rowIdByPosition=[];this._rowPositionById={};this.each(function(row,i){this._rowIdByPosition.push(row[this.idAttribute]);this._rowPositionById[row[this.idAttribute]]=i},this)}return this},rows:function(filter){return new Dataset.DataView({filter:{rows:filter},parent:this})},sort:function(args){var options={},cachedRows=[];if(_.isFunction(args)){options.comparator=args}else{options=args||{}}if(options.comparator){this.comparator=options.comparator}else if(_.isUndefined(this.comparator)){throw new Error("Cannot sort without this.comparator.")}var i,j,row;for(i=0;i<this.length;i++){cachedRows[i]=this._row(i)}cachedRows.sort(this.comparator);i=cachedRows.length;while(i--){row=cachedRows[i];this._rowIdByPosition[i]=row[this.idAttribute];this._rowPositionById[row[this.idAttribute]]=i;j=this._columns.length;while(j--){var col=this._columns[j];col.data[i]=row[col.name]}}if(this.syncable&&!options.silent){this.publish("sort")}return this},toJSON:function(){var rows=[];for(var i=0;i<this.length;i++){rows.push(this.rowByPosition(i))}return rows}})}(this,_));(function(global,_,moment){var Miso=global.Miso||(global.Miso={});var Dataset=global.Miso.Dataset;Dataset.prototype=new Dataset.DataView();_.extend(Dataset.prototype,{_initialize:function(options){if(options.sync===true){_.extend(this,Miso.Events);this.syncable=true}this.idAttribute=options.idAttribute||'_id';this.importer=options.importer||null;this.parser=options.parser||Dataset.Parsers.Obj;if(_.isUndefined(options.parser)){if(options.strict){this.parser=Dataset.Parsers.Strict}else if(options.delimiter){this.parser=Dataset.Parsers.Delimited}}if(this.importer===null){if(options.url){if(!options.interval){this.importer=Dataset.Importers.Remote}else{this.importer=Dataset.Importers.Polling;this.interval=options.interval}}else{this.importer=Dataset.Importers.Local}}this.parser=new this.parser(options);if(this.parser instanceof Dataset.Parsers.Delimited){options.dataType="text"}this.importer=new this.importer(options);if(options.comparator){this.comparator=options.comparator}if(options.ready){this.ready=options.ready}if(options.resetOnFetch){this.resetOnFetch=options.resetOnFetch}if(options.uniqueAgainst){this.uniqueAgainst=options.uniqueAgainst}if(_.isUndefined(options.data)&&_.isUndefined(options.url)){this._addIdColumn()}if(options.deferred){this.deferred=options.deferred}else{this.deferred=new _.Deferred()}if(options.columns){this.addColumns(options.columns)}},fetch:function(options){options=options||{};var dfd=this.deferred;if(_.isNull(this.importer)){throw"No importer defined"}this.importer.fetch({success:_.bind(function(data){try{this._apply(data)}catch(e){if(options.error){options.error.call(this,e)}else{throw e}}if(this.comparator){this.sort()}if(this.ready){this.ready.call(this)}if(options.success){options.success.call(this)}dfd.resolveWith(this,[this])},this),error:_.bind(function(e){if(options.error){options.error.call(this,e)}dfd.reject(e)},this)});return dfd.promise()},_applications:{againstColumn:function(data){var rows=[],colNames=_.keys(data),row,uniqName=this.uniqueAgainst,uniqCol=this.column(uniqName),toAdd=[],toUpdate=[],toRemove=[];_.each(data[uniqName],function(key,dataIndex){var rowIndex=uniqCol.data.indexOf(Dataset.types[uniqCol.type].coerce(key));var row={};_.each(data,function(col,name){row[name]=col[dataIndex]});if(rowIndex===-1){toAdd.push(row)}else{toUpdate.push(row);row[this.idAttribute]=this.rowById(this.column(this.idAttribute).data[rowIndex])[this.idAttribute];this.update(row)}},this);if(toAdd.length>0){this.add(toAdd)}},blind:function(data){var columnName,columnData,rows=[],row;var colNames=_.keys(data),dataLength=_.max(_.map(colNames,function(name){return data[name].length},this));for(var i=0;i<dataLength;i++){row={};for(var j=0;j<colNames.length;j++){row[colNames[j]]=data[colNames[j]][i]}rows.push(row)}this.add(rows)}},_apply:function(data){var parsed=this.parser.parse(data);if(!this.fetched){this._addIdColumn();this.addColumns(_.map(parsed.columns,function(name){return{name:name}}));Dataset.Builder.detectColumnTypes(this,parsed.data);this._applications.blind.call(this,parsed.data);this.fetched=true}else if(this.resetOnFetch){this.reset();this._applications.blind.call(this,parsed.data)}else if(this.uniqueAgainst){if(!this.hasColumn(this.uniqueAgainst)){throw new Error("You requested a unique add against a column that doesn't exist.")}this._applications.againstColumn.call(this,parsed.data)}else{this._applications.blind.call(this,parsed.data)}Dataset.Builder.cacheRows(this)},addColumns:function(columns){_.each(columns,function(column){this.addColumn(column)},this)},addComputedColumn:function(name,type,func){if(!_.isUndefined(this.column(name))){throw"There is already a column by this name."}else{if(typeof Dataset.types[type]==="undefined"){throw"The type "+type+" doesn't exist"}var column=new Dataset.Column({name:name,type:type,func:_.bind(func,this)});this._columns.push(column);this._computedColumns.push(column);this._columnPositionByName[column.name]=this._columns.length-1;if(this.length>0){this.each(function(row,i){column.compute(row,i)},this)}return column}},addColumn:function(column){if(!_.isUndefined(this.column(column.name))){return false}column=new Dataset.Column(column);this._columns.push(column);this._columnPositionByName[column.name]=this._columns.length-1;return column},_addIdColumn:function(count){if(!_.isUndefined(this.column(this.idAttribute))){return}var ids=[];if(count&&count>0){_.times(count,function(){ids.push(_.uniqueId())})}var idCol=this.addColumn({name:this.idAttribute,data:ids});if(this.idAttribute==="_id"){idCol.type="number"}if(this._columnPositionByName[this.idAttribute]!==0){var oldIdColPos=this._columnPositionByName[this.idAttribute];this._columns.splice(oldIdColPos,1);this._columns.unshift(idCol);this._columnPositionByName[this.idAttribute]=0;_.each(this._columnPositionByName,function(pos,colName){if(colName!==this.idAttribute&&this._columnPositionByName[colName]<oldIdColPos){this._columnPositionByName[colName]++}},this)}},add:function(rows,options){options=options||{};if(!_.isArray(rows)){rows=[rows]}var deltas=[];_.each(rows,function(row){if(!row[this.idAttribute]){row[this.idAttribute]=_.uniqueId()}this._add(row,options);if(this.syncable&&!options.silent){deltas.push({changed:row})}},this);if(this.syncable&&!options.silent){var e=Dataset.Events._buildEvent(deltas,this);this.publish('add',e);this.publish('change',e)}return this},remove:function(filter,options){filter=this._rowFilter(filter);var deltas=[],rowsToRemove=[];this.each(function(row,rowIndex){if(filter(row)){rowsToRemove.push(row[this.idAttribute]);deltas.push({old:row})}});_.each(rowsToRemove,function(rowId){this._remove(rowId)},this);if(this.syncable&&(!options||!options.silent)){var ev=Dataset.Events._buildEvent(deltas,this);this.publish('remove',ev);this.publish('change',ev)}},_arrayUpdate:function(rows){var deltas=[];_.each(rows,function(newRow){var delta={old:{},changed:{}};delta[this.idAttribute]=newRow[this.idAttribute];var pos=this._rowPositionById[newRow[this.idAttribute]];_.each(newRow,function(value,prop){var column=this._columns[this._columnPositionByName[prop]];var type=Dataset.types[column.type];if((column.name===this.idAttribute)&&(column.data[pos]!==value)){throw"You can't update the id column"}if(typeof column==="undefined"){throw"column "+prop+" not found!"}if(!type.test(value,column)){throw"Value is incorrect type"}if(this._computedColumns[column.name]){return}value=type.coerce(value,column);if(!_.isUndefined(column.before)){value=column.before(value)}if(column.data[pos]!==value){delta.old[prop]=column.data[pos];column.data[pos]=value;delta.changed[prop]=value}},this);if(typeof this._computedColumns!=="undefined"){_.each(this._computedColumns,function(column){var temprow=_.extend({},this._row(pos)),oldValue=temprow[column.name],newValue=column.compute(temprow,pos);if(oldValue!==newValue){delta.old[column.name]=oldValue;column.data[pos]=newValue;delta.changed[column.name]=newValue}},this)}if(_.keys(delta.changed).length>0){deltas.push(delta)}},this);return deltas},_functionUpdate:function(func){var rows=[];for(var i=0;i<this.length;i++){var newRow=func(this.rowByPosition(i));if(newRow!==false){rows.push(newRow)}}return this._arrayUpdate(rows)},update:function(rowsOrFunction,options){var deltas;if(_.isFunction(rowsOrFunction)){deltas=this._functionUpdate(rowsOrFunction)}else{var rows=_.isArray(rowsOrFunction)?rowsOrFunction:[rowsOrFunction];deltas=this._arrayUpdate(rows)}if(this.syncable&&(!options||!options.silent)){var ev=Dataset.Events._buildEvent(deltas,this);this.publish('update',ev);this.publish('change',ev)}return this},reset:function(options){_.each(this._columns,function(col){col.data=[]});this.length=0;if(this.syncable&&(!options||!options.silent)){this.publish("reset")}}})}(this,_,moment));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.typeOf=function(value,options){var types=_.keys(Dataset.types),chosenType;types.push(types.splice(_.indexOf(types,'string'),1)[0]);types.push(types.splice(_.indexOf(types,'mixed'),1)[0]);chosenType=_.find(types,function(type){return Dataset.types[type].test(value,options)});chosenType=_.isUndefined(chosenType)?'string':chosenType;return chosenType};Dataset.types={mixed:{name:'mixed',coerce:function(v){if(_.isNull(v)||typeof v==="undefined"||_.isNaN(v)){return null}return v},test:function(){return true},compare:function(s1,s2){if(_.isEqual(s1,s2)){return 0}if(s1<s2){return-1}if(s1>s2){return 1}},numeric:function(v){return v===null||_.isNaN(+v)?null:+v}},string:{name:"string",coerce:function(v){if(_.isNaN(v)||v===null||typeof v==="undefined"){return null}return v.toString()},test:function(v){return(v===null||typeof v==="undefined"||typeof v==='string')},compare:function(s1,s2){if(s1==null&&s2!=null){return-1}if(s1!=null&&s2==null){return 1}if(s1<s2){return-1}if(s1>s2){return 1}return 0},numeric:function(value){if(_.isNaN(+value)||value===null){return null}else if(_.isNumber(+value)){return+value}else{return null}}},"boolean":{name:"boolean",regexp:/^(true|false)$/,coerce:function(v){if(_.isNaN(v)||v===null||typeof v==="undefined"){return null}if(v==='false'){return false}return Boolean(v)},test:function(v){if(v===null||typeof v==="undefined"||typeof v==='boolean'||this.regexp.test(v)){return true}else{return false}},compare:function(n1,n2){if(n1==null&&n2!=null){return-1}if(n1!=null&&n2==null){return 1}if(n1==null&&n2==null){return 0}if(n1===n2){return 0}return(n1<n2?-1:1)},numeric:function(value){if(value===null||_.isNaN(value)){return null}else{return(value)?1:0}}},number:{name:"number",regexp:/^\s*[\-\.]?[0-9]+([\.][0-9]+)?\s*$/,coerce:function(v){var cv=+v;if(_.isNull(v)||typeof v==="undefined"||_.isNaN(cv)){return null}return cv},test:function(v){if(v===null||typeof v==="undefined"||typeof v==='number'||this.regexp.test(v)){return true}else{return false}},compare:function(n1,n2){if(n1==null&&n2!=null){return-1}if(n1!=null&&n2==null){return 1}if(n1==null&&n2==null){return 0}if(n1===n2){return 0}return(n1<n2?-1:1)},numeric:function(value){if(_.isNaN(value)||value===null){return null}return value}},time:{name:"time",format:"DD/MM/YYYY",_formatLookup:[['DD',"\\d{2}"],['D',"\\d{1}|\\d{2}"],['MM',"\\d{2}"],['M',"\\d{1}|\\d{2}"],['YYYY',"\\d{4}"],['YY',"\\d{2}"],['A',"[AM|PM]"],['hh',"\\d{2}"],['h',"\\d{1}|\\d{2}"],['mm',"\\d{2}"],['m',"\\d{1}|\\d{2}"],['ss',"\\d{2}"],['s',"\\d{1}|\\d{2}"],['ZZ',"[-|+]\\d{4}"],['Z',"[-|+]\\d{2}:\\d{2}"]],_regexpTable:{},_regexp:function(format){if(this._regexpTable[format]){return new RegExp(this._regexpTable[format],'g')}var regexp=format;_.each(this._formatLookup,function(pair){regexp=regexp.replace(pair[0],pair[1])},this);regexp=regexp.split("/").join("\\/");this._regexpTable[format]=regexp;return new RegExp(this._regexpTable[format],'g')},coerce:function(v,options){options=options||{};if(_.isNull(v)||typeof v==="undefined"||_.isNaN(v)){return null}if(_.isString(v)){var format=options.format||this.format;return moment(v,format)}else if(_.isNumber(v)){return moment(v)}else{return v}},test:function(v,options){options=options||{};if(v===null||typeof v==="undefined"){return true}if(_.isString(v)){var format=options.format||this.format,regex=this._regexp(format);return regex.test(v)}else{return true}},compare:function(d1,d2){if(d1<d2){return-1}if(d1>d2){return 1}return 0},numeric:function(value){if(_.isNaN(value)||value===null){return null}return value.valueOf()}}}}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Event=function(deltas,dataset){if(!_.isArray(deltas)){deltas=[deltas]}this.deltas=deltas;this.dataset=dataset||null};_.extend(Dataset.Event.prototype,{affectedColumns:function(){var cols=[];_.each(this.deltas,function(delta){delta.old=(delta.old||[]);delta.changed=(delta.changed||[]);cols=_.chain(cols).union(_.keys(delta.old),_.keys(delta.changed)).reject(function(col){return col===this.dataset.idAttribute},this).value()},this);return cols}});_.extend(Dataset.Event,{isRemove:function(delta){if(_.isUndefined(delta.changed)||_.keys(delta.changed).length===0){return true}else{return false}},isAdd:function(delta){if(_.isUndefined(delta.old)||_.keys(delta.old).length===0){return true}else{return false}},isUpdate:function(delta){if(!this.isRemove(delta)&&!this.isAdd(delta)){return true}else{return false}}});Dataset.Events={};Dataset.Events._buildEvent=function(delta,dataset){return new Dataset.Event(delta,dataset)}}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Builder={detectColumnType:function(column,data){var type=_.inject(data.slice(0,5),function(memo,value){var t=Dataset.typeOf(value);if(value!==""&&memo.indexOf(t)===-1&&!_.isNull(value)){memo.push(t)}return memo},[]);if(type.length===1){column.type=type[0]}else{column.type='mixed'}return column},detectColumnTypes:function(dataset,parsedData){_.each(parsedData,function(data,columnName){var column=dataset.column(columnName);if(column.type){column.force=true;return}else{Dataset.Builder.detectColumnType(column,data)}},this)},cacheRows:function(dataset){Dataset.Builder.clearRowCache(dataset);_.each(dataset._columns[dataset._columnPositionByName[dataset.idAttribute]].data,function(id,index){dataset._rowPositionById[id]=index;dataset._rowIdByPosition.push(id)},dataset);var rowLengths=_.uniq(_.map(dataset._columns,function(column){return column.data.length}));if(rowLengths.length>1){throw new Error("Row lengths need to be the same. Empty values should be set to null."+_.map(dataset._columns,function(c){return c.data+"|||"}))}else{dataset.length=rowLengths[0]}},clearRowCache:function(dataset){dataset._rowPositionById={};dataset._rowIdByPosition=[]},cacheColumns:function(dataset){dataset._columnPositionByName={};_.each(dataset._columns,function(column,i){dataset._columnPositionByName[column.name]=i})}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0),j=this.length;i<j;i++){if(this[i]===obj){return i}}return-1}}}(this,_));(function(global,_){var Miso=global.Miso||(global.Miso={});var Dataset=global.Miso.Dataset;Dataset.Product=function(options){options=options||{};this.func=options.func;if(options.columns){var column=options.columns;if(_.isArray(options.columns)){column=options.columns[0]}this.valuetype=column.type;this.numeric=function(){return column.toNumeric(this.value)}}this.func({silent:true});return this};_.extend(Dataset.Product.prototype,Miso.Events,{val:function(){return this.value},type:function(){return this.valuetype},_sync:function(event){this.func()},_buildDelta:function(old,changed){return{old:old,changed:changed}}});Dataset.Product.define=function(func){return function(columns,options){options=options||{};var columnObjects=this._findColumns(columns);var _self=this;options.type=options.type||columnObjects[0].type;options.typeOptions=options.typeOptions||columnObjects[0].typeOptions;var producer=function(){var val=func.call(_self,columnObjects,options);return Dataset.types[options.type].coerce(val,options.typeOptions)};if(this.syncable){var prod=new Dataset.Product({columns:columnObjects,func:function(options){options=options||{};var delta=this._buildDelta(this.value,producer.call(_self));this.value=delta.changed;if(_self.syncable){var event=Dataset.Events._buildEvent(delta,this);if(!_.isUndefined(delta.old)&&!options.silent&&delta.old!==delta.changed){this.publish("change",event)}}}});this.subscribe("change",prod._sync,{context:prod});return prod}else{return producer.call(_self)}}};_.extend(Dataset.DataView.prototype,{_findColumns:function(columns){var columnObjects=[];if(_.isUndefined(columns)){columns=this.columnNames()}columns=_.isArray(columns)?columns:[columns];_.each(columns,function(column){column=this._columns[this._columnPositionByName[column]];columnObjects.push(column)},this);return columnObjects},sum:Dataset.Product.define(function(columns,options){_.each(columns,function(col){if(col.type===Dataset.types.time.name){throw new Error("Can't sum up time")}});return _.sum(_.map(columns,function(c){return c._sum()}))}),max:Dataset.Product.define(function(columns,options){return _.max(_.map(columns,function(c){return c._max()}))}),min:Dataset.Product.define(function(columns,options){return _.min(_.map(columns,function(c){return c._min()}))}),mean:Dataset.Product.define(function(columns,options){var vals=[];_.each(columns,function(col){vals.push(col.data)});vals=_.flatten(vals);var type=columns[0].type;vals=_.map(vals,function(v){return Dataset.types[type].numeric(v)});return _.mean(vals)})})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Importers=function(data,options){};Dataset.Importers.prototype.extract=function(data){data=_.clone(data);return data}}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Importers.Local=function(options){options=options||{};this.data=options.data||null;this.extract=options.extract||this.extract};_.extend(Dataset.Importers.Local.prototype,Dataset.Importers.prototype,{fetch:function(options){var data=options.data?options.data:this.data;options.success(this.extract(data))}})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Importers.Remote=function(options){options=options||{};this._url=options.url;this.extract=options.extract||this.extract;this.params={type:"GET",url:_.isFunction(this._url)?_.bind(this._url,this):this._url,dataType:options.dataType?options.dataType:(options.jsonp?"jsonp":"json"),callback:options.callback}};_.extend(Dataset.Importers.Remote.prototype,Dataset.Importers.prototype,{fetch:function(options){var callback=_.bind(function(data){options.success(this.extract(data))},this);if(this.callback){window[this.callback]=callback}Dataset.Xhr(_.extend(this.params,{success:this.callback?this.callback:callback,error:options.error}))}});var _xhrSetup={url:"",data:"",dataType:"",success:function(){},type:"GET",async:true,xhr:function(){return global.ActiveXObject?new global.ActiveXObject("Microsoft.XMLHTTP"):new global.XMLHttpRequest()}},rparams=/\?/;Dataset.Xhr=function(options){options.dataType=options.dataType&&options.dataType.toLowerCase()||null;var url=_.isFunction(options.url)?options.url():options.url;if(options.dataType&&(options.dataType==="jsonp"||options.dataType==="script")){Dataset.Xhr.getJSONP(url,options.success,options.dataType==="script",options.error,options.callback);return}var settings=_.extend({},_xhrSetup,options,{url:url});settings.ajax=settings.xhr();if(settings.ajax){if(settings.type==="GET"&&settings.data){settings.url+=(rparams.test(settings.url)?"&":"?")+settings.data;settings.data=null}settings.ajax.open(settings.type,settings.url,settings.async);settings.ajax.send(settings.data||null);return Dataset.Xhr.httpData(settings)}};Dataset.Xhr.getJSONP=function(url,success,isScript,error,callback){if(isScript){var scripts=document.querySelectorAll("script[src=\""+url+"\"]");if(scripts.length){if(success){success(true)}return}}var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script"),paramStr=url.split("?")[1],isFired=false,params=[],parts;if(paramStr&&!isScript){params=paramStr.split("&")}if(params.length){parts=params[params.length-1].split("=")}if(!callback){var fallback=_.uniqueId('callback');callback=params.length?(parts[1]?parts[1]:fallback):fallback}if(!paramStr&&!isScript){url+="?"}if(!paramStr||!/callback/.test(paramStr)){if(paramStr){url+='&'}url+="callback="+callback}if(callback&&!isScript){if(!!window[callback]){callback=callback+(+new Date())+_.uniqueId()}window[callback]=function(data){if(success){success(data)}isFired=true};if(parts){url=url.replace(parts.join("="),parts[0]+"="+callback)}}script.onload=script.onreadystatechange=function(){if(!script.readyState||/loaded|complete/.test(script.readyState)){if(isScript){if(success){success()}}if(isFired){try{delete window[callback]}catch(e){window[callback]=void 0}head.removeChild(script)}}};script.onerror=function(e){if(error){error.call(null,e)}};script.src=url;head.insertBefore(script,head.firstChild);return};Dataset.Xhr.httpData=function(settings){var data,json=null,handleResponse;handleResponse=function(){if(settings.ajax.readyState===4){try{json=JSON.parse(settings.ajax.responseText)}catch(e){}data={xml:settings.ajax.responseXML,text:settings.ajax.responseText,json:json};if(settings.dataType){data=data[settings.dataType]}if(/(2..)/.test(settings.ajax.status)){settings.success.call(settings.ajax,data)}else{if(settings.error){settings.error.call(null,settings.ajax.statusText)}}}};if(settings.ajax.readyState===4){handleResponse()}else{settings.ajax.onreadystatechange=handleResponse}return data}}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Importers.Polling=function(options){options=options||{};this.interval=options.interval||1000;this._def=null;Dataset.Importers.Remote.apply(this,[options])};_.extend(Dataset.Importers.Polling.prototype,Dataset.Importers.Remote.prototype,{fetch:function(options){if(this._def===null){this._def=_.Deferred();this.success_callback=_.bind(function(data){options.success(this.extract(data));this._def.resolve(this)},this);this.error_callback=_.bind(function(error){options.error(error);this._def.reject(error)},this)}_.when(this._def.promise()).then(function(importer){var callback=_.bind(function(){this.fetch({success:this.success_callback,error:this.error_callback})},importer);importer._timeout=setTimeout(callback,importer.interval);importer._def=_.Deferred()});Dataset.Xhr(_.extend(this.params,{success:this.success_callback,error:this.error_callback}));global.imp=this},stop:function(){if(this._def!==null){this._def.reject()}if(typeof this._timeout!=="undefined"){clearTimeout(this._timeout)}},start:function(){if(this._def!==null){this._def=_.Deferred();this.fetch()}}})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Importers.GoogleSpreadsheet=function(options){options=options||{};if(options.url){options.url=options.url}else{if(_.isUndefined(options.key)){throw new Error("Set options 'key' properties to point to your google document.")}else{if(options.fast){options.url="https://spreadsheets.google.com/tq?key="+options.key;if(typeof options.sheetName==="undefined"){options.sheetName="Sheet1"}options.url+="&sheet="+options.sheetName;this.callback="misodsgs"+new Date().getTime();options.url+="&tqx=version:0.6;responseHandler:"+this.callback;options.url+=";reqId:0;out:json&tq&_=1335871249558#";delete options.sheetName}else{options.url="https://spreadsheets.google.com/feeds/cells/"+options.key+"/"+options.worksheet+"/public/basic?alt=json-in-script&callback="}delete options.key}}this.params={type:"GET",url:options.url,dataType:"jsonp"};return this};_.extend(Dataset.Importers.GoogleSpreadsheet.prototype,Dataset.Importers.Remote.prototype)}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Parsers=function(options){this.options=options||{}};_.extend(Dataset.Parsers.prototype,{parse:function(){}})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Parsers.Strict=function(options){this.options=options||{}};_.extend(Dataset.Parsers.Strict.prototype,Dataset.Parsers.prototype,{parse:function(data){var columnData={},columnNames=[];_.each(data.columns,function(column){if(columnNames.indexOf(column.name)!==-1){throw new Error("You have more than one column named \""+column.name+"\"")}else{columnNames.push(column.name);columnData[column.name]=column.data}});return{columns:columnNames,data:columnData}}})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Parsers.Obj=Dataset.Parsers;_.extend(Dataset.Parsers.Obj.prototype,Dataset.Parsers.prototype,{parse:function(data){var columns=_.keys(data[0]),columnData={};_.each(columns,function(key){columnData[key]=[]});_.each(columns,function(col){_.times(data.length,function(i){columnData[col].push(data[i][col])})});return{columns:columns,data:columnData}}})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Parsers.GoogleSpreadsheet=function(options){this.fast=options.fast||false};_.extend(Dataset.Parsers.GoogleSpreadsheet.prototype,Dataset.Parsers.prototype,{parse:function(data){var columns=[],columnData=[],keyedData={},i;if(typeof data.status!=="undefined"&&data.status==="error"){throw new Error("You can't use the fast importer for this url. Disable the fast flag")}if(this.fast){columns=_.pluck(data.table.cols,"label");if(_.unique(columns).length<columns.length){var dup="";_.inject(columns,function(memo,val){memo[val]=(memo[val]+1)||1;if(memo[val]>1){dup=val}return memo},{});throw new Error("You have more than one column named \""+dup+"\"")}_.each(data.table.rows,function(row){row=row.c;for(i=0;i<row.length;i++){columnData[i]=columnData[i]||[];if(row[i].v===""){columnData[i].push(null)}else{columnData[i].push(row[i].v)}}});_.each(columns,function(colName,index){keyedData[colName]=columnData[index]})}else{var positionRegex=/([A-Z]+)(\d+)/,columnPositions={};_.each(data.feed.entry,function(cell){var parts=positionRegex.exec(cell.title.$t),column=parts[1],position=parseInt(parts[2],10);if(position===1){if(columns.indexOf(cell.content.$t)!==-1){throw new Error("You have more than one column named \""+cell.content.$t+"\"")}else{columnPositions[column]=columnData.length;columns[columnPositions[column]]=cell.content.$t;columnData[columnPositions[column]]=[]}}else{var colpos=columnPositions[column];columnData[colpos][position-1]=cell.content.$t}},this);_.each(columnData,function(coldata,column){coldata.length=_.max(_.pluck(columnData,"length"));coldata.splice(0,1);for(var i=0;i<coldata.length;i++){if(_.isUndefined(coldata[i])||coldata[i]===""){coldata[i]=null}}keyedData[columns[column]]=coldata})}return{columns:columns,data:keyedData}}})}(this,_));(function(global,_){var Dataset=global.Miso.Dataset;Dataset.Parsers.Delimited=function(options){options=options||{};this.delimiter=options.delimiter||",";this.skipRows=options.skipRows||0;this.emptyValue=options.emptyValue||null;this.__delimiterPatterns=new RegExp(("(\\"+this.delimiter+"|\\r?\\n|\\r|^)"+"(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|"+"([^\"\\"+this.delimiter+"\\r\\n]*))"),"gi")};if(typeof String.prototype.trim!=='function'){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'')}}_.extend(Dataset.Parsers.Delimited.prototype,Dataset.Parsers.prototype,{parse:function(data){var columns=[],columnData={},uniqueSequence={};var uniqueId=function(str){if(!uniqueSequence[str]){uniqueSequence[str]=0}var id=str+uniqueSequence[str];uniqueSequence[str]+=1;return id};var parseCSV=function(delimiterPattern,strData,strDelimiter,skipRows,emptyValue){strDelimiter=(strDelimiter||",");var arrMatches=null;var columnCount=0;var columnCountComputed=false;var columnIndex=-1;var rowIndex=0;try{strData=strData.replace(/\s+$/,"").replace(/^[\r|\n|\s]+[\r|\n]/,"\n");if(skipRows>0){var rowsSeen=0,charIndex=0,strLen=strData.length;while(rowsSeen<skipRows&&charIndex<strLen){if(/\n|\r|\r\n/.test(strData.charAt(charIndex))){rowsSeen++}charIndex++}strData=strData.slice(charIndex,strLen)}function matchHandler(arrMatches){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&(strMatchedDelimiter!==strDelimiter)){rowIndex++;if(columnIndex<columnCount-1){rowIndex--;throw new Error("Not enough items in row")}columnCountComputed=true;columnIndex=0}else{if(!columnCountComputed){columnCount++}columnIndex++}var strMatchedValue=null;if(arrMatches[2]){strMatchedValue=arrMatches[2].replace(new RegExp("\"\"","g"),"\"")}else{strMatchedValue=arrMatches[3]}if(columnCountComputed){if(strMatchedValue===''){strMatchedValue=emptyValue}if(typeof columnData[columns[columnIndex]]==="undefined"){throw new Error("Too many items in row")}columnData[columns[columnIndex]].push(strMatchedValue)}else{var createColumnName=function(start){var newName=uniqueId(start);while(columns.indexOf(newName)!==-1){newName=uniqueId(start)}return newName};if(_.isUndefined(strMatchedValue)||strMatchedValue===''){strMatchedValue='X'}if(columns.indexOf(strMatchedValue)!==-1){strMatchedValue=createColumnName(strMatchedValue)}columns.push(strMatchedValue);columnData[strMatchedValue]=[]}}if(new RegExp('^'+strDelimiter).test(strData)){matchHandler(['','',undefined,''])}while(arrMatches=delimiterPattern.exec(strData)){matchHandler(arrMatches)}}catch(e){throw new Error("Error while parsing delimited data on row "+rowIndex+". Message: "+e.message)}return{columns:columns,data:columnData}};return parseCSV(this.__delimiterPatterns,data,this.delimiter,this.skipRows,this.emptyValue)}})}(this,_));(function(global,_){var Miso=global.Miso||(global.Miso={});var Dataset=Miso.Dataset;Dataset.Derived=function(options){options=options||{};Dataset.call(this);this.parent=options.parent;this.idAttribute="_id";this.method=options.method;this._addIdColumn();this.addColumn({name:"_oids",type:"mixed"});if(this.parent.syncable){_.extend(this,Miso.Events);this.syncable=true;this.parent.subscribe("change",this._sync,{context:this})}};Dataset.Derived.prototype=new Dataset();_.extend(Dataset.Derived.prototype,{_sync:function(){this.func.call(this.args);this.publish("change")}});_.extend(Dataset.DataView.prototype,{movingAverage:function(columns,size,options){options=options||{};var d=new Dataset.Derived({parent:this,method:options.method||_.mean,size:size,args:arguments});this.eachColumn(function(columnName){if(columnName===this.idAttribute){throw"You can't compute a moving average on the id column"}d.addColumn({name:columnName,type:this.column(columnName).type,data:[]})},this);Dataset.Builder.cacheColumns(d);var computeMovingAverage=function(){if(typeof columns==="string"){columns=[columns]}this.column(this.idAttribute).data=this.parent.column(this.parent.idAttribute).data.slice(size-1,this.parent.length);this.eachColumn(function(columnName,column){if(columns.indexOf(columnName)===-1&&columnName!=="_oids"){column.data=this.parent.column(columnName).data.slice(size-1,this.parent.length)}else{column.data=_.movingAvg(this.parent.column(columnName).data,size,this.method)}},this);this.length=this.parent.length-size+1;var oidcol=this.column("_oids");oidcol.data=[];for(var i=0;i<this.length;i++){oidcol.data.push(this.parent.column(this.parent.idAttribute).data.slice(i,i+size))}Dataset.Builder.cacheRows(this);return this};d.func=_.bind(computeMovingAverage,d);return d.func.call(d.args)},countBy:function(byColumn,options){options=options||{};var d=new Dataset.Derived({parent:this,method:_.sum,args:arguments});var parentByColumn=this.column(byColumn);d.addColumn({name:byColumn,type:parentByColumn.type});d.addColumn({name:'count',type:'number'});d.addColumn({name:'_oids',type:'mixed'});Dataset.Builder.cacheColumns(d);var names=d.column(byColumn).data,values=d.column('count').data,_oids=d.column('_oids').data,_ids=d.column(d.idAttribute).data;function findIndex(names,datum,type){var i;for(i=0;i<names.length;i++){if(Dataset.types[type].compare(names[i],datum)===0){return i}}return-1}this.each(function(row){var index=findIndex(names,row[byColumn],parentByColumn.type);if(index===-1){names.push(row[byColumn]);_ids.push(_.uniqueId());values.push(1);_oids.push([row[this.parent.idAttribute]])}else{values[index]+=1;_oids[index].push(row[this.parent.idAttribute])}},d);Dataset.Builder.cacheRows(d);return d},groupBy:function(byColumn,columns,options){options=options||{};var d=new Dataset.Derived({parent:this,method:options.method||_.sum,args:arguments});if(options&&options.preprocess){d.preprocess=options.preprocess}var newCols=_.union([byColumn],columns);_.each(newCols,function(columnName){this.addColumn({name:columnName,type:this.parent.column(columnName).type})},d);Dataset.Builder.cacheColumns(d);var computeGroupBy=function(){var self=this;Dataset.Builder.clearRowCache(this);var categoryPositions={},categoryCount=0,originalByColumn=this.parent.column(byColumn);for(var i=0;i<this.parent.length;i++){var category=null;if(this.preprocess){category=this.preprocess(originalByColumn.data[i])}else{category=originalByColumn.data[i]}if(_.isUndefined(categoryPositions[category])){categoryPositions[category]=categoryCount;_.each(columns,function(columnToGroup){var column=this.column(columnToGroup);var idCol=this.column(this.idAttribute);column.data[categoryCount]=[];idCol.data[categoryCount]=_.uniqueId()},this);this.column(byColumn).data[categoryCount]=category;categoryCount++}_.each(columns,function(columnToGroup){var column=this.column(columnToGroup),binPosition=categoryPositions[category];column.data[binPosition].push(this.parent.rowByPosition(i))},this)}var oidcol=this._columns[this._columnPositionByName._oids];oidcol.data=[];_.each(columns,function(colName){var column=this.column(colName);_.each(column.data,function(bin,binPos){if(_.isArray(bin)){oidcol.data[binPos]=oidcol.data[binPos]||[];oidcol.data[binPos].push(_.map(bin,function(row){return row[self.parent.idAttribute]}));oidcol.data[binPos]=_.flatten(oidcol.data[binPos]);column.data[binPos]=this.method(_.map(bin,function(row){return row[colName]}));this.length++}},this)},this);Dataset.Builder.cacheRows(this);return this};d.func=_.bind(computeGroupBy,d);return d.func.call(d.args)}})}(this,_));